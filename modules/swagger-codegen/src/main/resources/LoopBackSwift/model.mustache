{{#models}}{{#model}}import ObjectMapper
{{#useRealm}}
import Realm
import RealmSwift
{{/useRealm}}

public class {{classname}} : {{#useRealm}}Object, {{/useRealm}}Mappable, CustomStringConvertible { {{#vars}}{{#isEnum}}
    public enum {{datatypeWithEnum}} : String { {{#allowableValues}}{{#values}}
        case {{enum}} = "{{raw}}"{{/values}}{{/allowableValues}}
    }
{{/isEnum}}{{/vars}}{{#vars}}
    {{#isEnum}}public var {{name}}:{{{datatypeWithEnum}}}?{{#defaultValue}} = {{{defaultValue}}}{{/defaultValue}}{{/isEnum}}{{^isEnum}}{{#useRealm}}{{#isRaw}}private{{/isRaw}}{{^isRaw}}public{{/isRaw}}{{^isNumeric}}{{^isListContainer}} dynamic{{/isListContainer}}{{/isNumeric}} var {{name}}{{#isRaw}}Data{{/isRaw}}{{#isNumeric}} = RealmOptional<{{datatype}}>({{#defaultValue}}{{{defaultValue}}}{{/defaultValue}}){{/isNumeric}}{{^isNumeric}}{{#isListContainer}} = List<{{#items}}{{#isPrimitiveType}}Realm{{/isPrimitiveType}}{{datatype}}{{/items}}>(){{/isListContainer}}{{^isListContainer}}:{{{datatype}}}?{{#defaultValue}} = {{{defaultValue}}}{{/defaultValue}}{{/isListContainer}}{{/isNumeric}}{{/useRealm}}{{^useRealm}}public var {{name}}:{{datatype}}?{{#defaultValue}} = {{{defaultValue}}}{{/defaultValue}}{{/useRealm}}{{/isEnum}}{{#hasMore}}
{{/hasMore}}{{/vars}}{{#useRealm}}{{#rawVars}}

    public var {{name}}:[String : AnyObject]? {
        get {
            guard let {{name}}Data = {{name}}Data else { return [:] }

            do {
                return try NSJSONSerialization.JSONObjectWithData({{name}}Data, options: NSJSONReadingOptions()) as? [String : AnyObject]
            } catch {
                return [:]
            }
        }

        set {
            guard let value = newValue else { {{name}}Data = nil ; return }

            do {
                {{name}}Data = try NSJSONSerialization.dataWithJSONObject(value, options: NSJSONWritingOptions())
            } catch {
                {{name}}Data = nil
            }
        }
    }{{#hasMoreRaw}}
    {{/hasMoreRaw}}{{/rawVars}}{{/useRealm}}

    public {{#useRealm}}override {{/useRealm}}var description: String {
        return "{{classname}}({{#vars}}\n    {{name}}: \({{name}}){{#hasMore}},{{/hasMore}}{{^hasMore}}\n{{/hasMore}}{{/vars}})"
    }{{#useRealm}}{{#hasId}}

    public override static func primaryKey() -> String? {
        return "{{realmPrimaryKey}}"
    }{{/hasId}}{{#hasRawVars}}

    public override static func ignoredProperties() -> [String] {
        return [{{#rawVars}}"{{name}}"{{#hasMoreRaw}}, {{/hasMoreRaw}}{{/rawVars}}]
    }
    {{/hasRawVars}}

    public required init() {
        super.init()
    }

    public required init(value:AnyObject, schema:RLMSchema) {
        super.init(value: value, schema: schema)
    }

    public required init(realm:RLMRealm, schema:RLMObjectSchema) {
        super.init(realm: realm, schema: schema)
    }{{/useRealm}}{{^useRealm}}

    public init({{#vars}}{{name}}:{{#isEnum}}{{datatypeWithEnum}}{{/isEnum}}{{^isEnum}}{{datatype}}{{/isEnum}}? = {{#defaultValue}}{{{defaultValue}}}{{/defaultValue}}{{^defaultValue}}nil{{/defaultValue}}{{#hasMore}}, {{/hasMore}}{{/vars}}) {
        {{#vars}}self.{{name}} = {{name}}{{#hasMore}}
        {{/hasMore}}{{/vars}}
    }{{/useRealm}}

    public required convenience init?(_ map:Map) {
        self.init()
    }

    public func mapping(map:Map) {
        {{#vars}}{{^useRealm}}{{name}} <- map["{{baseName}}"]{{/useRealm}}{{#useRealm}}{{^isListContainer}}{{name}} <- map["{{baseName}}"]{{/isListContainer}}{{#isListContainer}}{{#items}}{{^isPrimitiveType}}{{name}} <- map["{{baseName}}"]{{/isPrimitiveType}}{{#isPrimitiveType}}
        var {{name}}:[{{datatype}}]? = nil
        {{name}} <- map["{{baseName}}"]

        {{name}}?.forEach { data in
            let value = Realm{{datatype}}()
            value.value = data
            self.{{name}}.append(value)
        }
        {{/isPrimitiveType}}{{/items}}{{/isListContainer}}{{/useRealm}}{{#hasMore}}
        {{/hasMore}}{{/vars}}
    }
}
{{/model}}
{{/models}}
