import Foundation

public class RequestAuthenticator : RequestTransformer {
    var methods:[String] = []

    public let authenticationMethods:[String : AuthenticationMethod] = {{^hasAuthMethods}}[:]{{/hasAuthMethods}}{{#hasAuthMethods}}[
        {{#authMethods}}"{{name}}" : {{#isApiKey}}APIKey(name: "{{keyParamName}}", type: {{#isKeyInHeader}}.Header{{/isKeyInHeader}}{{#isKeyInQuery}}.Query{{/isKeyInQuery}}){{/isApiKey}}{{#hasMore}},
        {{/hasMore}}{{/authMethods}}
    ]{{/hasAuthMethods}}

    public init() {
    }

    public func with(methods methods:[String]) -> RequestAuthenticator {
        self.methods = methods

        return self
    }

    public func transform(request:NSMutableURLRequest) {
        methods.forEach {
            if let authenticationMethod = authenticationMethods[$0] {
                authenticationMethod.authenticate(request)
            }
        }
    }
}
