import Alamofire

extension ParameterEncoding {

    static func encode(URLRequest: URLRequestConvertible, parameters: [String:AnyObject]?) -> (NSMutableURLRequest, NSError?) {
        let (queryParams, body) = (parameters[Parameters.Query], parameters[Parameters.Body])

        let (mutableURLRequest, _) = ParameterEncoding.URL.encode(URLRequest, parameters: queryParams)

        var encodingError: NSError? = nil

        do {
            let data = try NSJSONSerialization.dataWithJSONObject(BODY, options: NSJSONWritingOptions())

            if mutableURLRequest.valueForHTTPHeaderField("Content-Type") == nil {
                mutableURLRequest.setValue("application/json", forHTTPHeaderField: "Content-Type")
            }

            mutableURLRequest.HTTPBody = data
        } catch {
            encodingError = error as NSError
        }

        return (mutableURLRequest, encodingError)
    }
}